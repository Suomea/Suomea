电商场景比如下单，供应链系统比如物资出入库，如果因为网络抖动、微服务重试机制、前端界面卡住用户多次提交等，都有可能造成重复提交。

## 前端解决
### 获得响应前禁止按钮
1. 提交按钮在接口返回之前禁用，防止用户重复点击。
2. 获得响应之后，如果成功一般应该是跳转到结算界面；如果业务异常，则重新恢复提交按钮。

### 短时间内禁止多次事件
1. 设置事件响应频次，如果两次点击事件时间间隔小于 100ms 则忽略后一次点击事件。

## 后端解决

### 请求携带 requestId
1. 前端进入界面先调用后端接口获取一个 requestId，后端将 requestId 存储在 Redis 中。
2. 前端提交接口时带上 requestId。
3. 后端判断 Redis 中 requestId 是否存在，不存在提示重复提交。
4. 如果 requestId 存在，则调用 Redis 删除命令，删除成功进入后续流程，删除失败（已经被删除了）提示重复提交。

这种方式需要前后端配合，并且在提交订单之前需要提前调用接口获取 requestId，增加了请求链路的复杂性。还有就是如果通过重复校验，进入后续的处理流程时，由于某些原因导致下单不成功，等待条件成功时 requestId 需要重新获取。

### 分布式锁
1. 后端结合用户ID 和请求参数的核心特征（能够在业务上判断重复提交的参数），计算一个摘要作为分布式锁的 key。
2. 生成订单时尝试进行加锁，如果获锁成功则进入后续流程；获锁失败则说明重复提交。

如果提交业务 1 秒处理完毕之后释放锁，然后重复提交又来了，怎么处理？可以将分布式锁的过期时间设置为 1 分钟，并且业务完成之后不释放锁，这样 1 分钟以内的提交都会算是重复提交了。当然还是要结合业务逻辑。