---
comments: true
---

在 Windows 上搭建汇编语言学习环境。

## 需要安装的软件：
### [VSCode](https://code.visualstudio.com/) 代码编辑器
需要安装的插件：

 - The Netwide Assembler (NASM) 插件，汇编代码高亮插件。
 - Hex Editor 插件，能够以十六进制查看和编辑文件。

### [NASM](https://nasm.us/) x86 架构的汇编器

### [dd](http://www.chrysocome.net/dd) 一个读取转换并输出数据的工具
用来将指令写入磁盘的第一个扇区。

### [Bochs](https://bochs.sourceforge.io/) x86 计算机模拟器
用来模拟 x86 架构的计算机，主要包括 x86CPU、通用的 I/O 设备和自定义的 BIOS。其附带的 `bximage` 工具能用来创建磁盘镜像文件。

### [QEMU](https://www.qemu.org/) 另一个模拟器
使用附带的 `qemu-img` 命令来进行磁盘镜像文件格式的转换，制作虚拟机（Hyper-V、Virtual Box、VMware）可识别的虚拟磁盘。

### [mingw64](https://www.mingw-w64.org/) Windows 下 GCC 编译器
使用附带的 make 软件，方便编译。

## 汇编 `RGB`
工作目录 `/computer/assembly`，目录结构如下：
```
# /computer/assembly
2023/04/18  13:19             2,483 bochsrc.bxrc
2023/07/25  13:17        10,321,920 c.img
2023/07/25  13:17               219 hello.asm
2023/07/25  13:17               512 hello.bin
2023/04/24  21:53               112 makefile
```
### `hello.asm`
编写汇编源码。
```asm
mov ax, 0xb800
mov ds, ax

mov byte [0], 'R'
mov byte [1], 0x0C
mov byte [2], 'G'
mov byte [3], 0x0A
mov byte [4], 'B'
mov byte [5], 0000_1001B

halt:
jmp halt

times 510 - ($ -$$) db 0
db 0x55, 0xaa
```

### `c.img`
创建磁盘镜像文件，用来当作系统启动盘。

命令行直接输入命令 `bximage`，第一步选择 `Create new floppy or hard disk image`，其它步骤使用默认值即可。

### `makefile`
编写编译配置文件，内容如下：
```make
hello.bin:
	nasm hello.asm -o hello.bin
	
c.img: hello.bin
	dd if=hello.bin of=c.img bs=512 count=1
```

### `bochsrc.bxrc`
创建 `Bochs` 配置文件，需要生成。使用 `bochs -q` 命令，选中 Configuration -> Save，保存配置文件 `bochsrc.bxrc` 到工作目录即可。

编译配置文件，将原本的内容替换为新的内容。旧的 -> 新的
```text
boot: floppy -> boot: disk
ata0-master: type=none -> ata0-master: type=disk, path="c.img", mode=flat
```
### 运行
编译命令：`make c.img`  
启动命令：`bochs`

QA:

1. img 格式的文件是什么含义？  
      使用 `bximage` 命令创建的 img 后缀的文件属于磁盘镜像文件，文件的内容相当于一个真实的物理磁盘所包含的全部信息，包括磁盘文件系统，引导扇区和其他信息。
      
      这种磁盘镜像文件通常用来备份数据或者回滚系统状态；也可以被模拟器软件当作物理磁盘加载，向其中读取或者写入信息。